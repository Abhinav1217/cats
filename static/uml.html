<!DOCTYPE html>
<html>

  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Dependency Graph</title>

    <link type="text/css" rel="stylesheet" href="js/uml/css/UDStyle.css" media="screen" />
    <script  type="text/javascript" src="js/jquery-latest.js"></script>
    <script  type="text/javascript" src="js/arbor.js"></script>
    <script type="text/javascript" src="js/uml/UDCore.js"></script>
    <script type="text/javascript" src="js/uml/UDModules.js"></script>


    <script type="text/javascript">
            var x = 5;
            var y = 50;
            var diagram;
            var layoutEngine;
            var iter = 1000;
            
            var dict = {};
            
            function getLabel(name) {
                if (name.lastIndexOf('/') > -1) {
                    return name.substring(name.lastIndexOf('/')+1);
                } else {
                   return name.substring(name.lastIndexOf('\\')+1);
                }
            }
            
            function draw(name) {
              if (dict[name]) return dict[name];               
               var c = new UMLPackage({ x:x, y:y });
               c.setName(getLabel(name));
               c.notifyChange();
               diagram.addElement(c);               
               dict[name]=c;
               layoutEngine.addNode(name, {node:c});
               next();
               return c;
            }
    
            function next() {
               x = x + 250;
               if (x > 800) {
                   x = 5;
                   y = y + 100;
               }
   
            }
    
    window.onload = function(){
            layoutEngine = arbor.ParticleSystem();
            layoutEngine.screenSize(1000,1000);
            layoutEngine.parameters({repulsion:2000, gravity:true});
            
            diagram = new UMLClassDiagram({id: 'classDiagram', width: 2000, height: 2000 });
            diagram.setName("Module Dependencies");
            var deps = window.dependencies;
            deps.forEach(function (file){
               
               var a = draw(file.src);
               
                             
               file.ref.forEach(function(ref) {
                 var b = draw(ref);
                 var depLine = new UMLDependency({a:a,b:b});                
                 diagram.addElement(depLine);
                 layoutEngine.addEdge(file.src,ref,{});
               });
                             
            });
            
            var myRenderer = {
                init:  function(system){ },
                redraw:function(){ 
                    // alert("redraw");
                    iter--;
                    if (iter < 0) layoutEngine.stop(); 
                    layoutEngine.eachNode(function(node, pt){
                        var n = node.data.node;
                        n.position(2*pt.x,2*pt.y);
                     });
                    diagram.draw();
                }
            };
  
            layoutEngine.renderer = myRenderer;
            
            //Interaction is possible (editable)
            diagram.interaction(true);
        }
    </script>
    </head>

    <body>
<div id="classDiagram"></div>
    </body>
</html>

